{% extends 'base.html.twig' %}

{% block title %}GSB Espace Visiteur{% endblock %}

{% block body %}
    <div class="container">
        <div class="columns is-10 is-centered is-multiline">
            <div class="column is-12">
                <div class="box is-transparent has-no-padding animate__animated animate__fadeInDown">
                    <div class="columns bar is-mobile">
                        <div id="menupastyear" class="column has-15px-padding-top">
                            <i id="arrowpastyear" class="fas fa-chevron-left fa-lg grow cursor-pointer"></i>
                            <strong>{{year-1}}</strong>
                        </div>
                        <div class="column is-9-desktop is-8-tablet is-6-mobile">
                            <p id="pastyear" class="is-hidden"><strong>{{year-1}}</strong></p>
                            <p id="currentyear"><strong>{{year}}</strong></p>
                        </div>
                        <div id="menunextyear" class="column has-15px-padding-top is-invisible">
                            <strong>{{year}}</strong>
                            <i id="arrownextyear" class="fas fa-chevron-right fa-lg grow cursor-pointer"></i>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrowpastyear"]').click(function () {
                                $("#columncurrent,#currentyear").fadeOut(150, function () {
                                    $("#columncurrent,#currentyear").hide();
                                    $("#menupastyear").fadeTo(500, 0, function(){
                                        $("#menupastyear").addClass('is-invisible')
                                    })
                                    $("#columnpast,#pastyear").removeClass('is-hidden').show();
                                    $("#menunextyear").fadeTo(500, 100, function(){
                                        $("#menunextyear").removeClass('is-invisible');
                                    })
                                })
                            });
                        });
                    </script>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrownextyear"]').click(function () {
                                $("#columnpast,#pastyear").fadeOut(150, function () {
                                    $("#columnpast,#pastyear").hide();
                                    $("#menunextyear").fadeTo(500, 0, function(){
                                        $("#menunextyear").addClass('is-invisible')
                                    })
                                    $("#columncurrent,#currentyear").show();
                                    $("#menupastyear").fadeTo(500, 100, function(){
                                        $("#menupastyear").removeClass('is-invisible');
                                    })
                                });
                            });
                        });
                    </script>

                </div>
            </div>
        </div>
        <div id="columncurrent" class="columns is-10 is-centered is-multiline">
            <div class="column is-12">
                <div class="columns is-multiline">
                    {% if ajouterfichefrais %}
                    <div id="divadd" class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxadd" class="box grow-smaller is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="columns is is-multiline">
                                    <div class="column">
                                        <div class="column is-12 has-no-padding-bottom">
                                            <strong>Ajouter une nouvelle</strong>
                                        </div>
                                        <div class="column is-12 has-2px-padding-top">
                                            <strong>fiche de frais</strong>
                                        </div>
                                        <div class="column is-12">
                                            <span class="icon is-insane is-left">
                                                <i class="fas fa-plus fa-7x"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function() {
                            $("#boxadd").click(function () {
                                $("#divadd").fadeOut(150, function () {
                                    $("#divadd").hide();

                                    $("#divac0").removeClass('is-hidden').show();
                                })
                            });
                        });
                    </script>
                    <script>
                        $(document).ready(function() {
                            $('i[id*="arrownextyear"]').click(function () {
                                $("#columnpast,#pastyear").fadeOut(150, function () {
                                    $("#columnpast,#pastyear").hide();
                                    $("#menunextyear").fadeTo(500, 0, function(){
                                        $("#menunextyear").addClass('is-invisible')
                                    })
                                    $("#columncurrent,#currentyear").show();
                                    $("#menupastyear").fadeTo(500, 100, function(){
                                        $("#menupastyear").removeClass('is-invisible');
                                    })
                                });
                            });
                        });
                    </script>
                    <div id="divac0" class="column is-3-desktop is-6-tablet is-12-mobile is-hidden">
                        <div id="boxac0" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-success">
                                        <span class="icon">
                                            <i class="fas fa-file-invoice"></i>
                                        </span>
                                            <span>
                                            <strong>{{yearmonth | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ year }}</strong>
                                            </span>
                                        <span class="icon">
                                            <i class="fas fa-lock-open"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="columns is-flex-mobile">
                                    <div class="column has-finest-padding-1024px is-bigger-for-button-1024px">
                                        <button id="modifyac0" class="button is-fullwidth is-small is-success has-border-radius-40">
                                            <span class="icon">
                                                <i class="fas fa-edit"></i>
                                            </span>
                                            <span>EN COURS</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                                <span>Période</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                ---
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-money-check"></i>
                                                </span>
                                                <span>Justificatifs</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                aucuns
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                                <span>Montant validé</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                        <strong>
                                            + 0 €
                                        </strong>
                                    </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-hourglass-half"></i>
                                                </span>
                                                <span>État</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                            Non enregistré
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-file-alt"></i>
                                                </span>
                                                <span>N° Fiche</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                ---
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Frais</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                <strong>
                                                - 0 €
                                                </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Hors frais</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-danger has-no-border-radius-bottom-right is-a-lot-transparent">
                                                <strong>
                                                    - 0 €
                                                </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac0" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-background-transparent">
                                                - 0 €
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                            <i id="arrowac0" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac0,#modifyac0").click(function () {
                                                    if ($("#arrowac0").hasClass("fa-chevron-down")) {

                                                        $("#arrowac0").addClass("unique");
                                                        $('#boxac0').addClass('unique');
                                                        $('#columnac0').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current');

                                                                $('div[id*="columnac"]').not(".unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not(".unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not(".unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not(".unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac0').fadeOut(150, function () {
                                                            $('#arrowac0').removeClass('fa-chevron-down');

                                                            $('#columnac0').fadeIn(150, function (){
                                                                $('#columnac0').removeClass('is-hidden');

                                                                $('#arrowac0').fadeIn(150, function () {
                                                                    $('#arrowac0').addClass('fa-chevron-up');
                                                                    $('#boxac0').addClass('is-asked-to-be-modified-current').removeClass('is-transparent');

                                                                    $("#arrowac0").removeClass("unique");
                                                                    $('#boxac0').removeClass('unique');
                                                                    $('#columnac0').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac0').fadeOut(150, function () {
                                                            $('#arrowac0').removeClass('fa-chevron-up');
                                                            $('#boxac0').addClass('is-transparent').removeClass('is-asked-to-be-modified-current');

                                                            $('#columnac0').fadeOut(150, function () {
                                                                $('#columnac0').addClass('is-hidden');

                                                                $('#arrowac0').fadeIn(150, function () {
                                                                    $('#arrowac0').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                            /*function openBox""""(){
                                                const theBox = document.getElementById("box"""");
                                                const theArrow = document.getElementById("arrow""""");
                                                const theModifyingColumn = document.getElementById("column"""")
                                                const allModifyingColumnsShown = document.getElementsByClassName("id_modfyingColumns column is-12")
                                                const allBoxesDown = document.getElementsByClassName("id-boxes box is-like-une-fiche-frais is-asked-to-be-modified");
                                                const allArrowsUp = document.getElementsByClassName("id_arrows fas fa-chevron-up fa-lg grow");
                                                if(theArrow.classList.contains("fa-chevron-down")){
                                                    [].forEach.call(allBoxesDown, function(oneBoxDown){
                                                        oneBoxDown.classList.remove("is-asked-to-be-modified");
                                                        oneBoxDown.classList.add("is-transparent")
                                                    });
                                                    [].forEach.call(allArrowsUp,function(oneArrowUp){
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.remove("fa-chevron-up");
                                                        }, 200);
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.add("fa-chevron-down");
                                                            oneArrowUp.classList.add("fadeIn");
                                                        }, 300);
                                                        });
                                                    [].forEach.call(allModifyingColumnsShown,function(oneModifyingColumnDown){
                                                        oneModifyingColumnDown.classList.add("is-hidden");
                                                    });
                                                    theBox.classList.remove("is-transparent")
                                                    theBox.classList.add("is-asked-to-be-modified");
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-down");
                                                        theArrow.classList.remove("fadeIn");
                                                    }, 200);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-up");
                                                        theModifyingColumn.classList.remove("is-hidden")
                                                    }, 300);
                                                }
                                                else{
                                                    theModifyingColumn.classList.add("fadeOut")
                                                    setTimeout(()=>{
                                                        theModifyingColumn.classList.remove("fadeOut")
                                                        theBox.classList.remove("is-asked-to-be-modified");
                                                        theBox.classList.add("is-transparent")
                                                        theModifyingColumn.classList.add("is-hidden")
                                                    }, 300)
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-up");
                                                    }, 500);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-down");
                                                        theArrow.classList.add("fadeIn");
                                                    }, 500);
                                                }
                                            }*/
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% for unefichefrais in fichesfraisanneecourante %}
                    {% if unefichefrais.date | format_datetime(pattern="YYYY-MM") == yearmonth %}
                    <div class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxac{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-success">
                                        <span class="icon">
                                            <i class="fas fa-file-invoice"></i>
                                        </span>
                                        <span>
                                            <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                        </span>
                                        <span class="icon">
                                            <i class="fas fa-lock-open"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="columns is-flex-mobile">
                                    <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                        <button id="modifyac{{loop.index}}" class="button is-fullwidth is-small is-success has-border-radius-40">
                                            <span class="icon">
                                                <i class="fas fa-edit"></i>
                                            </span>
                                            <span>MODIFIER</span>
                                        </button>
                                    </div>
                                    <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                        <button class="button is-fullwidth is-small is-danger has-border-radius-40">
                                            <span>SUPPRIMER</span>
                                            <span class="icon">
                                                <i class="fas fa-trash-alt"></i>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                            <span class="icon">
                                                <i class="fas fa-calendar-alt"></i>
                                            </span>
                                            <span>Période</span>
                                        </span>
                                            <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                            {{unefichefrais.date | date("m/Y")}}
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                            <span class="icon">
                                                <i class="fas fa-money-check"></i>
                                            </span>
                                            <span>Justificatifs</span>
                                        </span>
                                        <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                            {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                            <span class="icon">
                                                <i class="fas fa-check-square"></i>
                                            </span>
                                            <span>Montant validé</span>
                                        </span>
                                        <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                            <strong>
                                                + {{unefichefrais.montantvalide | default(0)}} €
                                            </strong>
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                            <span class="icon">
                                                <i class="fas fa-hourglass-half"></i>
                                            </span>
                                            <span>État</span>
                                        </span>
                                        <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                            {{unefichefrais.idetat}}
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                            <span class="icon">
                                                <i class="fas fa-file-alt"></i>
                                            </span>
                                            <span>N° Fiche</span>
                                        </span>
                                        <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                            {{unefichefrais.idfichefrais}}
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger is-dark has-no-border-radius">
                                            <span class="icon">
                                                <i class="fas fa-money-bill"></i>
                                            </span>
                                            <span>Frais</span>
                                        </span>
                                        <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                            <strong>
                                            - {{ unefichefrais.montanttotalfraisforfait }} €
                                            </strong>
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                        <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                            <span class="icon">
                                                <i class="fas fa-money-bill"></i>
                                            </span>
                                            <span>Hors frais</span>
                                        </span>
                                        <span class="tag has-text-bigger has-text-danger has-no-border-radius-bottom-right is-a-lot-transparent">
                                            <strong>
                                                {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                    - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                {% else %}
                                                    - 0 €
                                                {% endif %}
                                            </strong>
                                        </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-background-transparent">
                                                - {{ unefichefrais.ETP.idfraisforfait.libellefraisforfait ~ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.KM.idfraisforfait.libellefraisforfait ~ unefichefrais.KM.quantite * unefichefrais.KM.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.NUI.idfraisforfait.libellefraisforfait ~ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.REP.idfraisforfait.libellefraisforfait ~ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}

                                                {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                    {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                        {{ unelignefraishorsforfait.libelle }}
                                                        - {{ unelignefraishorsforfait.montant }} €
                                                    {% endfor %}
                                                {% else %}
                                                    - 0 €
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-6px-padding-top-on-mobile">
                                    <span class="icon is-small">
                                    <i id="arrowac{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                    </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac{{loop.index}},#modifyac{{loop.index}}").click(function () {
                                                    if ($("#arrowac{{loop.index}}").hasClass("fa-chevron-down")) {

                                                        $("#arrowac{{loop.index}}").addClass("unique");
                                                        $('#boxac{{loop.index}}').addClass('unique');
                                                        $('#columnac{{loop.index}}').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current');

                                                                $('div[id*="columnac"]').not(".unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not(".unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not(".unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not(".unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-down');

                                                            $('#columnac{{loop.index}}').fadeIn(150, function (){
                                                                $('#columnac{{loop.index}}').removeClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-up');
                                                                    $('#boxac{{loop.index}}').addClass('is-asked-to-be-modified-past').removeClass('is-transparent');

                                                                    $("#arrowac{{loop.index}}").removeClass("unique");
                                                                    $('#boxac{{loop.index}}').removeClass('unique');
                                                                    $('#columnac{{loop.index}}').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-up');
                                                            $('#boxac{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-past');

                                                            $('#columnac{{loop.index}}').fadeOut(150, function () {
                                                                $('#columnac{{loop.index}}').addClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                            /*function openBox""""(){
                                                const theBox = document.getElementById("box"""");
                                                const theArrow = document.getElementById("arrow""""");
                                                const theModifyingColumn = document.getElementById("column"""")
                                                const allModifyingColumnsShown = document.getElementsByClassName("id_modfyingColumns column is-12")
                                                const allBoxesDown = document.getElementsByClassName("id-boxes box is-like-une-fiche-frais is-asked-to-be-modified");
                                                const allArrowsUp = document.getElementsByClassName("id_arrows fas fa-chevron-up fa-lg grow");
                                                if(theArrow.classList.contains("fa-chevron-down")){
                                                    [].forEach.call(allBoxesDown, function(oneBoxDown){
                                                        oneBoxDown.classList.remove("is-asked-to-be-modified");
                                                        oneBoxDown.classList.add("is-transparent")
                                                    });
                                                    [].forEach.call(allArrowsUp,function(oneArrowUp){
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.remove("fa-chevron-up");
                                                        }, 200);
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.add("fa-chevron-down");
                                                            oneArrowUp.classList.add("fadeIn");
                                                        }, 300);
                                                        });
                                                    [].forEach.call(allModifyingColumnsShown,function(oneModifyingColumnDown){
                                                        oneModifyingColumnDown.classList.add("is-hidden");
                                                    });
                                                    theBox.classList.remove("is-transparent")
                                                    theBox.classList.add("is-asked-to-be-modified");
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-down");
                                                        theArrow.classList.remove("fadeIn");
                                                    }, 200);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-up");
                                                        theModifyingColumn.classList.remove("is-hidden")
                                                    }, 300);
                                                }
                                                else{
                                                    theModifyingColumn.classList.add("fadeOut")
                                                    setTimeout(()=>{
                                                        theModifyingColumn.classList.remove("fadeOut")
                                                        theBox.classList.remove("is-asked-to-be-modified");
                                                        theBox.classList.add("is-transparent")
                                                        theModifyingColumn.classList.add("is-hidden")
                                                    }, 300)
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-up");
                                                    }, 500);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-down");
                                                        theArrow.classList.add("fadeIn");
                                                    }, 500);
                                                }
                                            }*/
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="column is-3-desktop is-6-tablet is-12-mobile">
                        <div id="boxac{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                            <div class="column has-background-transparent">
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-warning">
                                        <span class="icon">
                                            <i class="fas fa-file-invoice"></i>
                                        </span>
                                        <span>
                                            <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                        </span>
                                        <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="columns is-flex-mobile">
                                    <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                        <button id="addac{{loop.index}}" class="button is-fullwidth is-small is-info has-border-radius-40">
                                            <span class="icon is-on-left">
                                                <i class="fas fa-plus-square"></i>
                                            </span>
                                            <span>AJOUTER</span>
                                        </button>
                                    </div>
                                    <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                        <button id="consultac{{loop.index}}" class="button is-fullwidth is-small is-carefull is-dark has-border-radius-40">
                                            <span>CONSULTER</span>
                                            <span class="icon">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                                <span>Période</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                {{unefichefrais.date | date("m/Y")}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-money-check"></i>
                                                </span>
                                                <span>Justificatifs</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                                <span>Montant validé</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                <strong>
                                                    + {{unefichefrais.montantvalide | default(0)}} €
                                                </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-hourglass-half"></i>
                                                </span>
                                                <span>État</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.idetat}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-file-alt"></i>
                                                </span>
                                                <span>N° Fiche</span>
                                            </span>
                                            <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.idfichefrais}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Frais</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                <strong>
                                                    - {{ unefichefrais.montanttotalfraisforfait }} €
                                                </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-2px-padding-top has-finest-padding-1024px">
                                        <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Hors frais</span>
                                            </span>
                                            <span class="tag has-text-bigger has-text-danger has-no-border-radius-bottom-right is-a-lot-transparent">
                                                <strong>
                                                    {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                        - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                    {% else %}
                                                        - 0 €
                                                    {% endif %}
                                                </strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div id="columnac{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                        <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                            <div class="column has-background-transparent">
                                                {{ unefichefrais.ETP.idfraisforfait.libellefraisforfait ~ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.KM.idfraisforfait.libellefraisforfait ~ unefichefrais.KM.quantite * unefichefrais.KM.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.NUI.idfraisforfait.libellefraisforfait ~ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}
                                                {{ unefichefrais.REP.idfraisforfait.libellefraisforfait ~ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}

                                                {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                    {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                        {{ unelignefraishorsforfait.libelle }}
                                                        - {{ unelignefraishorsforfait.montant }} €
                                                    {% endfor %}
                                                {% else %}
                                                    - 0 €
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div class="column has-no-padding-bottom has-2px-padding-top has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                        <i id="arrowac{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                        <script>
                                            $(document).ready(function() {
                                                $("#arrowac{{loop.index}},#addac{{ loop.index }},#consultac{{loop.index}}").click(function () {
                                                    if ($("#arrowac{{loop.index}}").hasClass("fa-chevron-down")) {

                                                        $("#arrowac{{loop.index}}").addClass("unique");
                                                        $('#boxac{{loop.index}}').addClass('unique');
                                                        $('#columnac{{loop.index}}').addClass('unique');

                                                        if($('i[id*="arrowac"]').not("unique").hasClass('fa-chevron-up')){

                                                            $('i[id*="arrowac"]').not("unique").fadeOut(150, function () {
                                                                $('i[id*="arrowac"]').not("unique").removeClass('fa-chevron-up');
                                                                $('div[id*="boxac"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current');

                                                                $('div[id*="columnac"]').not(".unique").fadeOut(150, function () {
                                                                    $('div[id*="columnac"]').not(".unique").addClass('is-hidden');

                                                                    $('i[id*="arrowac"]').not(".unique").fadeIn(150, function () {
                                                                        $('i[id*="arrowac"]').not(".unique").addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-down');

                                                            $('#columnac{{loop.index}}').fadeIn(150, function (){
                                                                $('#columnac{{loop.index}}').removeClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-up');
                                                                    $('#boxac{{loop.index}}').addClass('is-asked-to-be-modified-past').removeClass('is-transparent');

                                                                    $("#arrowac{{loop.index}}").removeClass("unique");
                                                                    $('#boxac{{loop.index}}').removeClass('unique');
                                                                    $('#columnac{{loop.index}}').removeClass('unique');
                                                                });
                                                            });
                                                        });
                                                    } else {

                                                        $('#arrowac{{loop.index}}').fadeOut(150, function () {
                                                            $('#arrowac{{loop.index}}').removeClass('fa-chevron-up');
                                                            $('#boxac{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-past');

                                                            $('#columnac{{loop.index}}').fadeOut(150, function () {
                                                                $('#columnac{{loop.index}}').addClass('is-hidden');

                                                                $('#arrowac{{loop.index}}').fadeIn(150, function () {
                                                                    $('#arrowac{{loop.index}}').addClass('fa-chevron-down');
                                                                });
                                                            });
                                                        });
                                                    }
                                                });
                                            });
                                            /*function openBox""""(){
                                                const theBox = document.getElementById("box"""");
                                                const theArrow = document.getElementById("arrow""""");
                                                const theModifyingColumn = document.getElementById("column"""")
                                                const allModifyingColumnsShown = document.getElementsByClassName("id_modfyingColumns column is-12")
                                                const allBoxesDown = document.getElementsByClassName("id-boxes box is-like-une-fiche-frais is-asked-to-be-modified");
                                                const allArrowsUp = document.getElementsByClassName("id_arrows fas fa-chevron-up fa-lg grow");
                                                if(theArrow.classList.contains("fa-chevron-down")){
                                                    [].forEach.call(allBoxesDown, function(oneBoxDown){
                                                        oneBoxDown.classList.remove("is-asked-to-be-modified");
                                                        oneBoxDown.classList.add("is-transparent")
                                                    });
                                                    [].forEach.call(allArrowsUp,function(oneArrowUp){
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.remove("fa-chevron-up");
                                                        }, 200);
                                                        setTimeout(() => {
                                                            oneArrowUp.classList.add("fa-chevron-down");
                                                            oneArrowUp.classList.add("fadeIn");
                                                        }, 300);
                                                        });
                                                    [].forEach.call(allModifyingColumnsShown,function(oneModifyingColumnDown){
                                                        oneModifyingColumnDown.classList.add("is-hidden");
                                                    });
                                                    theBox.classList.remove("is-transparent")
                                                    theBox.classList.add("is-asked-to-be-modified");
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-down");
                                                        theArrow.classList.remove("fadeIn");
                                                    }, 200);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-up");
                                                        theModifyingColumn.classList.remove("is-hidden")
                                                    }, 300);
                                                }
                                                else{
                                                    theModifyingColumn.classList.add("fadeOut")
                                                    setTimeout(()=>{
                                                        theModifyingColumn.classList.remove("fadeOut")
                                                        theBox.classList.remove("is-asked-to-be-modified");
                                                        theBox.classList.add("is-transparent")
                                                        theModifyingColumn.classList.add("is-hidden")
                                                    }, 300)
                                                    setTimeout(() => {
                                                        theArrow.classList.remove("fa-chevron-up");
                                                    }, 500);
                                                    setTimeout(() => {
                                                        theArrow.classList.add("fa-chevron-down");
                                                        theArrow.classList.add("fadeIn");
                                                    }, 500);
                                                }
                                            }*/
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <div id="columnpast" class="columns is-10 is-centered is-multiline is-hidden">
            <div class="column is-12">
                <div class="columns is-multiline">
                    {% for unefichefrais in fichesfraisanneepasse %}
                        <div class="column is-3-desktop is-6-tablet is-12-mobile">
                            <div id="boxap{{loop.index}}" class="box is-transparent is-like-une-fiche-frais animate__animated animate__fadeIn">
                                <div class="column has-background-transparent">
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px is-month-bar has-background-warning">
                                        <span class="icon">
                                            <i class="fas fa-file-invoice"></i>
                                        </span>
                                            <span>
                                            <strong>{{unefichefrais.date | format_datetime(pattern="MMMM", locale="fr") | upper}} {{ unefichefrais.date | format_datetime(pattern="YYYY") }}</strong>
                                        </span>
                                            <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                        </div>
                                    </div>
                                    <div class="columns is-flex-mobile">
                                        <div class="column has-finest-padding-1024px has-6px-margin-right is-bigger-for-button-1024px">
                                            <button id="addap{{loop.index}}" class="button is-fullwidth is-small is-info has-border-radius-40">
                                            <span class="icon is-on-left">
                                                <i class="fas fa-plus-square"></i>
                                            </span>
                                                <span>AJOUTER</span>
                                            </button>
                                        </div>
                                        <div class="column has-finest-padding-1024px has-6px-margin-left is-bigger-for-button-1024px">
                                            <button id="consultap{{loop.index}}" class="button is-fullwidth is-small is-carefull is-dark has-border-radius-40">
                                                <span>CONSULTER</span>
                                                <span class="icon">
                                                <i class="fas fa-eye"></i>
                                            </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius-top-left is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                                <span>Période</span>
                                            </span>
                                                <span class="tag has-text-bigger has-no-border-radius-top-right is-a-lot-transparent">
                                                {{unefichefrais.date | date("m/Y")}}
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-money-check"></i>
                                                </span>
                                                <span>Justificatifs</span>
                                            </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.nbjustificatifs | default("aucuns")}}
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                                <span>Montant validé</span>
                                            </span>
                                                <span class="tag has-text-bigger has-text-success has-no-border-radius is-a-lot-transparent">
                                                <strong>
                                                    + {{unefichefrais.montantvalide | default(0)}} €
                                                </strong>
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-hourglass-half"></i>
                                                </span>
                                                <span>État</span>
                                            </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.idetat}}
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger has-no-border-radius is-a-bit-transparent">
                                                <span class="icon">
                                                    <i class="fas fa-file-alt"></i>
                                                </span>
                                                <span>N° Fiche</span>
                                            </span>
                                                <span class="tag has-text-bigger has-no-border-radius is-a-lot-transparent">
                                                {{unefichefrais.idfichefrais}}
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Frais</span>
                                            </span>
                                                <span class="tag has-text-bigger has-text-danger has-no-border-radius is-a-lot-transparent">
                                                <strong>
                                                    - {{ unefichefrais.montanttotalfraisforfait }} €
                                                </strong>
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-2px-padding-top has-finest-padding-1024px">
                                            <div class="tags has-addons">
                                            <span class="tag has-text-bigger is-dark has-no-border-radius-bottom-left">
                                                <span class="icon">
                                                    <i class="fas fa-money-bill"></i>
                                                </span>
                                                <span>Hors frais</span>
                                            </span>
                                                <span class="tag has-text-bigger has-text-danger has-no-border-radius-bottom-right is-a-lot-transparent">
                                                <strong>
                                                    {% if unefichefrais.montanttotalfraishorsforfait is defined %}
                                                        - {{ unefichefrais.montanttotalfraishorsforfait }} €
                                                    {% else %}
                                                        - 0 €
                                                    {% endif %}
                                                </strong>
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div id="columnap{{loop.index}}" class="column is-12 is-hidden content-fichefrais">
                                            <div class="box is-like-hero-background animate__animated animate__fadeIn">
                                                <div class="column has-no-padding has-background-transparent">
                                                    <form class="has-text-left" action="{{path('setfraisforfait')}}" method="POST">
                                                        <div class="field has-addons">
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.ETP.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.ETP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.ETP.quantite }}" name="qtETP" required="required">
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.ETP.quantite * unefichefrais.ETP.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.KM.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.KM.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.KM.quantite }}" name="qtKM" required="required">
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.KM.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.KM.quantite * unefichefrais.KM.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.NUI.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.NUI.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.NUI.quantite }}" name="qtNUI" required="required">
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.NUI.quantite * unefichefrais.NUI.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control has-icons-left is-expanded">
                                                                <label class="label is-small is-aligned has-white-space-nowrap">{{ unefichefrais.REP.idfraisforfait.libellefraisforfait }}</label>
                                                                <input class="input is-small" type="number" placeholder="{{ unefichefrais.REP.idfraisforfait.idfraisforfait }}" value="{{ unefichefrais.REP.quantite }}" name="qtREP" required="required">
                                                                <span class="icon is-aligned is-small is-left">
                                                                    <i class="fas fa-edit"></i>
                                                                </span>
                                                                <label class="label is-small is-aligned has-8px-margin-top">{{ unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                                <label class="label is-small is-aligned">{{ unefichefrais.REP.quantite * unefichefrais.REP.idfraisforfait.montantfraisforfait }}</label>
                                                            </p>
                                                            <p class="control">
                                                                <input class="is-hidden" type="text" value="{{unefichefrais.idfichefrais}}" name="idfichefrais">
                                                                <button class="button is-small is-primary has-no-margin-bottom" type="submit">
                                                                    <SPAN>ENREGISTRER</SPAN>
                                                                    <span class="icon is-on-left">
                                                                        <i class="fas fa-save"></i>
                                                                    </span>
                                                                </button>
                                                                <label class="label is-small is-aligned has-8px-margin-top">Montant</label>
                                                                <label class="label is-small is-aligned">Total</label>
                                                            </p>
                                                        </div>
                                                        <hr>
                                                    </form>
                                                    <form class="has-text-left" action="" method="POST">
                                                    {% if unefichefrais.lignesfraishorsforfait is defined %}
                                                        {% for unelignefraishorsforfait in unefichefrais.lignesfraishorsforfait %}
                                                            {{ unelignefraishorsforfait.libelle }}
                                                            - {{ unelignefraishorsforfait.montant }} €
                                                        {% endfor %}
                                                    {% else %}
                                                        - 0 €
                                                    {% endif %}
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="columns">
                                        <div class="column has-no-padding-bottom has-2px-padding-top has-6px-padding-top-on-mobile">
                                        <span class="icon is-small">
                                        <i id="arrowap{{loop.index}}" class="fas fa-chevron-down fa-lg grow cursor-pointer"></i>
                                        </span>
                                            <script>
                                                $(document).ready(function() {
                                                    $("#arrowap{{loop.index}},#addap{{ loop.index }},#consultap{{loop.index}}").click(function () {
                                                        if ($("#arrowap{{loop.index}}").hasClass("fa-chevron-down")) {

                                                            $("#arrowap{{loop.index}}").addClass("unique");
                                                            $('#boxap{{loop.index}}').addClass('unique');
                                                            $('#columnap{{loop.index}}').addClass('unique');

                                                            if($('i[id*="arrowap"]').not("unique").hasClass('fa-chevron-up')){

                                                                $('i[id*="arrowap"]').not("unique").fadeOut(150, function () {
                                                                    $('i[id*="arrowap"]').not("unique").removeClass('fa-chevron-up');
                                                                    $('div[id*="boxap"]').not("unique").addClass('is-transparent').removeClass('is-asked-to-be-modified-past').removeClass('is-asked-to-be-modified-current');

                                                                    $('div[id*="columnap"]').not(".unique").fadeOut(150, function () {
                                                                        $('div[id*="columnap"]').not(".unique").addClass('is-hidden');

                                                                        $('i[id*="arrowap"]').not(".unique").fadeIn(150, function () {
                                                                            $('i[id*="arrowap"]').not(".unique").addClass('fa-chevron-down');
                                                                        });
                                                                    });
                                                                });
                                                            }

                                                            $('#arrowap{{loop.index}}').fadeOut(150, function () {
                                                                $('#arrowap{{loop.index}}').removeClass('fa-chevron-down');

                                                                $('#columnap{{loop.index}}').fadeIn(150, function (){
                                                                    $('#columnap{{loop.index}}').removeClass('is-hidden');

                                                                    $('#arrowap{{loop.index}}').fadeIn(150, function () {
                                                                        $('#arrowap{{loop.index}}').addClass('fa-chevron-up');
                                                                        $('#boxap{{loop.index}}').addClass('is-asked-to-be-modified-past').removeClass('is-transparent');

                                                                        $("#arrowap{{loop.index}}").removeClass("unique");
                                                                        $('#boxap{{loop.index}}').removeClass('unique');
                                                                        $('#columnap{{loop.index}}').removeClass('unique');
                                                                    });
                                                                });
                                                            });
                                                        } else {

                                                            $('#arrowap{{loop.index}}').fadeOut(150, function () {
                                                                $('#arrowap{{loop.index}}').removeClass('fa-chevron-up');
                                                                $('#boxap{{loop.index}}').addClass('is-transparent').removeClass('is-asked-to-be-modified-past');

                                                                $('#columnap{{loop.index}}').fadeOut(150, function () {
                                                                    $('#columnap{{loop.index}}').addClass('is-hidden');

                                                                    $('#arrowap{{loop.index}}').fadeIn(150, function () {
                                                                        $('#arrowap{{loop.index}}').addClass('fa-chevron-down');
                                                                    });
                                                                });
                                                            });
                                                        }
                                                    });
                                                });
                                                /*function openBox""""(){
                                                    const theBox = document.getElementById("box"""");
                                                    const theArrow = document.getElementById("arrow""""");
                                                    const theModifyingColumn = document.getElementById("column"""")
                                                    const allModifyingColumnsShown = document.getElementsByClassName("id_modfyingColumns column is-12")
                                                    const allBoxesDown = document.getElementsByClassName("id-boxes box is-like-une-fiche-frais is-asked-to-be-modified");
                                                    const allArrowsUp = document.getElementsByClassName("id_arrows fas fa-chevron-up fa-lg grow");
                                                    if(theArrow.classList.contains("fa-chevron-down")){
                                                        [].forEach.call(allBoxesDown, function(oneBoxDown){
                                                            oneBoxDown.classList.remove("is-asked-to-be-modified");
                                                            oneBoxDown.classList.add("is-transparent")
                                                        });
                                                        [].forEach.call(allArrowsUp,function(oneArrowUp){
                                                            setTimeout(() => {
                                                                oneArrowUp.classList.remove("fa-chevron-up");
                                                            }, 200);
                                                            setTimeout(() => {
                                                                oneArrowUp.classList.add("fa-chevron-down");
                                                                oneArrowUp.classList.add("fadeIn");
                                                            }, 300);
                                                            });
                                                        [].forEach.call(allModifyingColumnsShown,function(oneModifyingColumnDown){
                                                            oneModifyingColumnDown.classList.add("is-hidden");
                                                        });
                                                        theBox.classList.remove("is-transparent")
                                                        theBox.classList.add("is-asked-to-be-modified");
                                                        setTimeout(() => {
                                                            theArrow.classList.remove("fa-chevron-down");
                                                            theArrow.classList.remove("fadeIn");
                                                        }, 200);
                                                        setTimeout(() => {
                                                            theArrow.classList.add("fa-chevron-up");
                                                            theModifyingColumn.classList.remove("is-hidden")
                                                        }, 300);
                                                    }
                                                    else{
                                                        theModifyingColumn.classList.add("fadeOut")
                                                        setTimeout(()=>{
                                                            theModifyingColumn.classList.remove("fadeOut")
                                                            theBox.classList.remove("is-asked-to-be-modified");
                                                            theBox.classList.add("is-transparent")
                                                            theModifyingColumn.classList.add("is-hidden")
                                                        }, 300)
                                                        setTimeout(() => {
                                                            theArrow.classList.remove("fa-chevron-up");
                                                        }, 500);
                                                        setTimeout(() => {
                                                            theArrow.classList.add("fa-chevron-down");
                                                            theArrow.classList.add("fadeIn");
                                                        }, 500);
                                                    }
                                                }*/
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
